# **LDAP (Lightweight Directory Access Protocol)**

LDAP is a protocol used to access and manage directory information in a hierarchical tree structure. It provides centralized authentication and directory services for organizations.

---

## **What is LDAP?**

### **Definition**
LDAP stands for Lightweight Directory Access Protocol. It is important to understand that:
- **LDAP** is a **protocol**, not a software
- It is used to **access and manage directory information** over a network
- The protocol operates on port **389** (LDAP) and **636** (LDAPS/secure)

### **What is a Directory?**
In the context of LDAP, a directory refers to:
- A **special type of database** that stores data in a **tree-like hierarchy**
- Unlike traditional databases, it is optimized for **read-heavy operations** and **structured data**
- Directories typically store information about:
  - Users and their credentials
  - Groups and memberships
  - Computers and devices
  - Printers and resources
  - Organizational Units (OU)
  - Network resources

---

## **LDAP Data Structure**

### **How LDAP Stores Data**
LDAP organizes its data in a specific way:
- Data is organized in a **tree structure** called **Directory Information Tree (DIT)**
- Each item in the tree is called an **entry**
- Every entry in the directory contains:
  - A unique **Distinguished Name (DN)** that acts as its address
  - One or more **attributes** (name, email, password, etc.) that hold actual data

### **LDAP Tree Example**
Here's how Armour Infosec's directory structure might look:
```
                dc=armourinfosec,dc=com
                         |
         +---------------+---------------+
         |                               |
     ou=students                    ou=instructors
         |                               |
     uid=armour101                   uid=trainer1
     uid=armour102                   uid=trainer2
```

### **Distinguished Name (DN)**
The DN is a critical concept in LDAP:
- It represents the **full path** to an entry in the directory tree
- It uniquely identifies each entry in the entire directory
- DNs are read from **bottom to top**

**Example DN:**
```
uid=armour101,ou=students,dc=armourinfosec,dc=com
```
This DN means: user `armour101` is located in the `students` organizational unit within the `armourinfosec.com` domain.

---

## **LDAP Components and Terminology**

### **Common LDAP Terms**
To work with LDAP, you need to understand these fundamental terms:

| **Term** | **Description** |
|----------|-----------------|
| **dn** | Distinguished Name - full path of an entry |
| **rdn** | Relative DN - one component of DN (e.g., `uid=armour101`) |
| **dc** | Domain Component (`armourinfosec.com` → `dc=armourinfosec,dc=com`) |
| **ou** | Organizational Unit (e.g., `ou=students`, `ou=instructors`) |
| **cn** | Common Name - used for groups, computers |
| **uid** | User ID - unique identifier for users |
| **entry** | One record in LDAP database |
| **attribute** | Field in an entry (mail, sn, givenName) |
| **objectClass** | Defines schema/rules for entry type |

### **Common Object Classes**
Object classes define what type of entries can exist:
- **inetOrgPerson** - For user entries with internet attributes like email
- **posixAccount** - For Unix/Linux user accounts with UID/GID
- **posixGroup** - For Unix/Linux groups
- **organizationalUnit** - For creating organizational divisions

---

## **How LDAP Protocol Works**

The LDAP protocol operates through a series of operations:

### **1. Bind Operation**
First, a client must authenticate:
- Client authenticates to the LDAP server
- This is similar to a login process
- Example: Bind as `cn=admin,dc=armourinfosec,dc=com`

### **2. Search Operation**
Once authenticated, clients can search:
- Query the directory for specific entries
- Can filter by various attributes
- Returns matching entries based on criteria

### **3. Add/Modify/Delete Operations**
After binding, clients can manage data:
- **Add** - Create new entries in the directory
- **Modify** - Update existing entries' attributes
- **Delete** - Remove entries from the directory

### **4. Unbind Operation**
Finally, when done:
- Closes the connection to LDAP server

---

## **LDAP vs Active Directory**

Understanding the difference between LDAP and Active Directory:

| **Feature** | **LDAP** | **Active Directory** |
|-------------|----------|---------------------|
| **Type** | Open protocol standard | Microsoft's implementation |
| **Platform** | Cross-platform | Windows-centric |
| **Authentication** | Simple bind, SASL | Kerberos-based |
| **Additional Features** | Basic directory services | GPO, DNS, DHCP integration |
| **Schema** | Flexible and extensible | Pre-defined + extensible |

---

## **OpenLDAP Architecture**

### **What is OpenLDAP?**
OpenLDAP is the practical implementation of LDAP:
- **Open-source implementation** of the LDAP protocol
- Provides LDAP server and client tools for Linux
- Most common LDAP server on Linux systems

### **OpenLDAP Components**
The OpenLDAP suite includes these tools:

| **Component** | **Description** |
|---------------|-----------------|
| **slapd** | Main LDAP server daemon that handles requests |
| **slurpd** | Replication daemon (deprecated) |
| **ldapadd** | Tool to add entries to directory |
| **ldapsearch** | Tool to search directory entries |
| **ldapmodify** | Tool to modify existing entries |
| **ldapdelete** | Tool to delete entries |
| **ldappasswd** | Tool to change user passwords |

### **Directory Structure**
OpenLDAP organizes its files as follows:
```
/etc/openldap/
├── slapd.d/               # Dynamic configuration directory
│   ├── cn=config.ldif     # Main config database
│   └── cn=config/         # Config sub-entries
├── ldap.conf              # Client configuration
└── schema/                # Schema definitions
    ├── core.ldif
    ├── cosine.ldif
    └── inetorgperson.ldif

/var/lib/ldap/             # Database files (BDB/MDB)
```

### **Configuration Methods**
OpenLDAP configuration has evolved:
- **Old method**: `/etc/openldap/slapd.conf` (static file)
- **New method**: `/etc/openldap/slapd.d/` (dynamic configuration)
- Dynamic config allows runtime changes via LDAP protocol itself

### **Database Backends**
OpenLDAP supports different storage backends:
- **MDB** (Memory-Mapped Database) - Default, fast and reliable
- **BDB** (Berkeley DB) - Legacy, being phased out
- **HDB** (Hierarchical DB) - Variant of BDB

---

## **LDAP Use Cases**

### **Common Applications**
Organizations use LDAP for:
- **Centralized Authentication** - Single sign-on for multiple systems
- **User Management** - Central user database
- **Address Book** - Shared contact information
- **Email Routing** - Mail server directory lookups
- **Network Resource Management** - Printers, computers inventory
- **Application Configuration** - Storing app settings centrally

### **Integration Examples**
LDAP integrates with many systems:
- Linux authentication (PAM/NSS)
- Web application authentication
- Mail servers (Postfix, Dovecot)
- File servers (Samba)
- VPN authentication
- Git/SVN repositories

---

## **LDAP Data Format (LDIF)**

### **What is LDIF?**
LDIF is how LDAP data is represented:
- **LDAP Data Interchange Format**
- Text format for representing LDAP entries
- Used for import/export operations

### **LDIF Structure**
Example of an Armour Infosec student entry:
```
dn: uid=armour101,ou=students,dc=armourinfosec,dc=com
objectClass: inetOrgPerson
objectClass: posixAccount
uid: armour101
cn: Armour Student
sn: Student
givenName: Armour
mail: armour101@armourinfosec.com
uidNumber: 1001
gidNumber: 1001
homeDirectory: /home/armour101
loginShell: /bin/bash
```

---

## **LDAP Security**

### **Authentication Methods**
LDAP supports various security mechanisms:
- **Anonymous Bind** - No authentication required
- **Simple Bind** - Clear text password (insecure)
- **SASL** - Secure authentication mechanisms
- **LDAPS** - LDAP over SSL/TLS (port 636)
- **StartTLS** - Upgrade plain connection to TLS

### **Access Control**
LDAP implements access control through:
- **ACLs** (Access Control Lists) define permissions
- Restrictions can be applied by:
  - User/Group identity
  - IP address
  - Specific attributes
  - Operations (read, write, search)

---

## **Summary**

LDAP is a protocol for accessing hierarchical directory information. Key points to remember:

- Stores data in a tree structure with unique DNs for each entry
- Each entry has attributes defined by object classes
- OpenLDAP is the primary Linux implementation
- Uses port 389 (LDAP) and 636 (LDAPS)
- Configuration stored in `/etc/openldap/slapd.d/`
- Database files in `/var/lib/ldap/`
- Client tools: ldapsearch, ldapadd, ldapmodify, ldapdelete
- Common for centralized authentication and user management
- LDIF format for data import/export

---
