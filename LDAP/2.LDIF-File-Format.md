# **LDIF (LDAP Data Interchange Format)**

LDIF is a text-based format used to represent LDAP directory entries and modifications. It serves as the standard way to import, export, and manage LDAP data.

---

## **LDAP Architecture and Concepts**

### **Directory Information Tree (DIT)**
LDAP stores all data in a hierarchical tree structure called the Directory Information Tree (DIT). This structure is similar to a filesystem where each node can contain other nodes or actual data entries.

The DIT for Armour Infosec might look like:
```
dc=armourinfosec,dc=com
├── ou=Students
│   ├── uid=armour101
│   └── uid=armour102
├── ou=Instructors
│   ├── uid=trainer01
│   └── uid=trainer02
└── ou=Groups
    ├── cn=cybersec
    └── cn=networking
```

In this structure:
- **dc=armourinfosec,dc=com** represents the domain (root of the tree)
- **ou=Students** is an Organizational Unit containing student entries
- **uid=armour101** is a specific student entry
- **cn=cybersec** is a group under the Groups OU

### **LDAP Entry**
An entry is a single record in the LDAP directory. Each entry consists of:
- A **Distinguished Name (DN)** that uniquely identifies its location
- One or more **attributes** that store actual data
- At least one **objectClass** that defines what type of entry it is

---

## **Distinguished Names (DN) and Relative DN (RDN)**

### **Distinguished Name (DN)**
The DN is the complete address of an entry in the LDAP tree. It provides the full path from the entry to the root of the directory.

**Example DN:**
```
dn: uid=armour101,ou=Students,dc=armourinfosec,dc=com
```
This DN indicates that user "armour101" is located in the "Students" organizational unit within the "armourinfosec.com" domain.

### **Relative Distinguished Name (RDN)**
The RDN is just the first component of the DN. It identifies the entry relative to its parent container.

In the above example:
- RDN: `uid=armour101`
- Parent: `ou=Students,dc=armourinfosec,dc=com`

---

## **Common LDAP Attributes**

Understanding LDAP attributes is essential for creating proper entries:

| **Attribute** | **Description** |
|---------------|-----------------|
| **dn** | Distinguished Name - full path to the entry |
| **cn** | Common Name - full name of person or group |
| **sn** | Surname - family/last name |
| **uid** | User ID - unique login identifier |
| **ou** | Organizational Unit name |
| **dc** | Domain Component |
| **mail** | Email address |
| **objectClass** | Defines entry type and available attributes |
| **gidNumber** | Group ID number (POSIX) |
| **uidNumber** | User ID number (POSIX) |
| **memberUid** | Members of a POSIX group |
| **userPassword** | Encrypted password |
| **homeDirectory** | User's home directory path |
| **loginShell** | User's default shell |

---

## **Object Classes**

### **What are Object Classes?**
Every LDAP entry must have at least one objectClass attribute. The objectClass determines:
- What type of entry it is
- Which attributes are mandatory
- Which attributes are optional

### **Common Object Classes**
The most frequently used object classes include:

- **top** - Base class that all other classes inherit from
- **person** - Basic person entry with cn and sn
- **organizationalPerson** - Extends person with organizational attributes
- **inetOrgPerson** - Adds internet-related attributes like email
- **posixAccount** - Unix/Linux user account with UID, GID, home directory
- **posixGroup** - Unix/Linux group with GID
- **organizationalUnit** - Container for organizing entries

### **Combining Object Classes**
Entries can have multiple object classes to inherit attributes from each:
```ldif
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: posixAccount
```
This combination allows creating a user entry with both personal information and Unix account details.

---

## **LDIF File Structure**

### **Basic LDIF Format**
An LDIF file consists of entries separated by blank lines. Each entry follows this structure:
```ldif
dn: <distinguished name>
objectClass: <object class>
<attribute>: <value>
<attribute>: <value>
```

### **Example User Entry**
Here's a complete LDIF entry for an Armour Infosec student:
```ldif
dn: uid=armour101,ou=Students,dc=armourinfosec,dc=com
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: posixAccount
cn: Armour Student
sn: Student
uid: armour101
uidNumber: 1001
gidNumber: 1000
homeDirectory: /home/armour101
loginShell: /bin/bash
mail: armour101@armourinfosec.com
userPassword: {SSHA}encrypted_password_here
```

### **Important Rules**
When creating LDIF files, remember:
- The DN must always be the first line of each entry
- Include all required objectClass definitions
- Blank lines separate entries
- Comments start with #
- Long lines can be continued by starting the next line with a space

---

## **Creating Organizational Structure**

### **Order Matters**
When building an LDAP directory, you must create parent containers before child entries. The correct order is:
1. Domain root (if not existing)
2. Organizational Units
3. Groups
4. Users
5. Group memberships

### **Organizational Units vs Groups**
Understanding the difference is crucial:

**Organizational Unit (OU):**
- A container for organizing entries
- Created using `organizationalUnit` objectClass
- Used for hierarchical organization
- Can contain users, groups, and other OUs

**Group:**
- A collection of users for access control
- Created using `posixGroup` or `groupOfNames` objectClass
- Used for permissions and authorization
- Contains references to user entries

### **Nested OUs**
Yes, you can create OUs within OUs:
```ldif
dn: ou=Training,ou=Departments,dc=armourinfosec,dc=com
objectClass: top
objectClass: organizationalUnit
ou: Training
```

---

## **Complete LDIF Example**

Here's a comprehensive LDIF file for setting up Armour Infosec's directory structure:

```ldif
# Domain root (if needed)
dn: dc=armourinfosec,dc=com
objectClass: top
objectClass: domain
dc: armourinfosec

# Organizational Units
dn: ou=Students,dc=armourinfosec,dc=com
objectClass: top
objectClass: organizationalUnit
ou: Students

dn: ou=Instructors,dc=armourinfosec,dc=com
objectClass: top
objectClass: organizationalUnit
ou: Instructors

dn: ou=Groups,dc=armourinfosec,dc=com
objectClass: top
objectClass: organizationalUnit
ou: Groups

# Groups
dn: cn=cybersec,ou=Groups,dc=armourinfosec,dc=com
objectClass: top
objectClass: posixGroup
cn: cybersec
gidNumber: 2001

dn: cn=networking,ou=Groups,dc=armourinfosec,dc=com
objectClass: top
objectClass: posixGroup
cn: networking
gidNumber: 2002

# Student entries
dn: uid=armour101,ou=Students,dc=armourinfosec,dc=com
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: posixAccount
cn: Armour CyberSec Student
sn: Student
uid: armour101
uidNumber: 1001
gidNumber: 2001
homeDirectory: /home/armour101
loginShell: /bin/bash
mail: armour101@armourinfosec.com
userPassword: {SSHA}encrypted_password

# Instructor entries
dn: uid=trainer01,ou=Instructors,dc=armourinfosec,dc=com
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: posixAccount
cn: Security Trainer
sn: Trainer
uid: trainer01
uidNumber: 2001
gidNumber: 2001
homeDirectory: /home/trainer01
loginShell: /bin/bash
mail: trainer01@armourinfosec.com
userPassword: {SSHA}encrypted_password

# Add users to groups
dn: cn=cybersec,ou=Groups,dc=armourinfosec,dc=com
changetype: modify
add: memberUid
memberUid: armour101
memberUid: trainer01
```

---

## **Working with LDIF Files**

### **Adding Entries**
To import an LDIF file into your LDAP directory:
```bash
ldapadd -x -D "cn=admin,dc=armourinfosec,dc=com" -W -f structure.ldif
```

### **Common LDAP Commands**
The main commands for working with LDIF files are:
- **ldapadd** - Add new entries from LDIF
- **ldapmodify** - Modify existing entries
- **ldapdelete** - Delete entries
- **ldapsearch** - Search and export to LDIF

### **LDIF for Modifications**
LDIF can also describe modifications to existing entries:
```ldif
dn: uid=armour101,ou=Students,dc=armourinfosec,dc=com
changetype: modify
replace: mail
mail: newemail@armourinfosec.com
```

---

## **Mandatory vs Optional Attributes**

### **Understanding Requirements**
Each objectClass defines which attributes are mandatory (MUST) and optional (MAY). For example:

**inetOrgPerson requires:**
- cn (Common Name)
- sn (Surname)

**posixAccount requires:**
- cn, uid, uidNumber, gidNumber, homeDirectory

### **Why Include 'top' ObjectClass?**
The `top` objectClass is the base class from which all other classes inherit. While some LDAP servers add it automatically, best practice is to always include it explicitly to ensure compatibility.

---

## **Summary**

LDIF is the standard format for representing LDAP data. Key points to remember:

- LDIF files are plain text with specific formatting rules
- Entries must include DN, objectClass, and required attributes
- Create parent containers before child entries
- Separate entries with blank lines
- Use proper objectClass combinations for desired functionality
- The `top` objectClass should always be included
- Order

---
