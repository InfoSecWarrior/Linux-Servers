# **LDIF (LDAP Data Interchange Format)**

LDIF is a text-based format used to represent LDAP directory entries and modifications. It serves as the standard way to import, export, and manage LDAP data.

---

## **LDAP Architecture and Concepts**

### **Directory Information Tree (DIT)**
LDAP stores all data in a hierarchical tree structure called the Directory Information Tree (DIT). This structure is similar to a filesystem where each node can contain other nodes or actual data entries.

The DIT for Armour Infosec is structured as follows:
```
dc=armour,dc=local
├── ou=it
│   ├── uid=it1
│   └── uid=it2
├── ou=hr
│   ├── uid=hr1
│   └── uid=hr2
└── ou=groups
    ├── cn=it
    └── cn=hr
```

In this structure:
- **dc=armour,dc=local** represents the domain, which is the root of the tree.
- **ou=it** is an Organizational Unit containing entries for the IT department.
- **uid=it1** is an individual user entry within the `it` OU.
- **cn=it** is a group entry under the `groups` OU.

### **LDAP Entry**
An entry is a single record in the LDAP directory. Each entry consists of:
- A **Distinguished Name (DN)** that uniquely identifies its location.
- One or more **attributes** that store the actual data.
- At least one **objectClass** that defines what type of entry it is.

---

## **Distinguished Names (DN) and Relative DN (RDN)**

### **Distinguished Name (DN)**
The DN is the complete, unique address of an entry in the LDAP tree. It provides the full path from the entry all the way to the root of the directory.

**Example DN:**
```
dn: uid=it1,ou=it,dc=armour,dc=local
```

### **Relative Distinguished Name (RDN)**
The RDN is the first component of the DN. It identifies the entry relative to its parent container.

**Example Breakdown:**
- **DN:** `uid=it1,ou=it,dc=armour,dc=local` (The full, unique path)
- **RDN:** `uid=it1` (The unique part of the entry within its parent)
- **Parent:** `ou=it,dc=armour,dc=local` (The container holding the entry)

---

## **Common LDAP Attributes**

Understanding LDAP attributes is essential for creating proper entries:

| **Attribute** | **Description** |
|---------------|-----------------|
| **dn** | Distinguished Name - full path to the entry |
| **cn** | Common Name - full name of a person or group |
| **sn** | Surname - the family or last name |
| **uid** | User ID - the unique login identifier |
| **ou** | Organizational Unit name |
| **dc** | Domain Component |
| **mail** | Email address |
| **objectClass** | Defines the entry type and its available attributes |
| **gidNumber** | Group ID number (for POSIX systems) |
| **uidNumber** | User ID number (for POSIX systems) |
| **memberUid** | A member of a POSIX group, identified by their UID |
| **userPassword** | The encrypted password hash |
| **homeDirectory** | The user's home directory path (e.g., `/home/it1`) |
| **loginShell** | The user's default shell (e.g., `/bin/bash`) |

---

## **Object Classes**

### **What are Object Classes?**
Every LDAP entry must have at least one `objectClass` attribute. The objectClass determines the schema for the entry, defining which attributes are mandatory (MUST be included) and which are optional (MAY be included).

### **Common Object Classes**
- **top**: The fundamental base class that all other classes inherit from.
- **person**: A basic person entry, requiring `cn` and `sn`.
- **organizationalPerson**: Extends `person` with attributes for an organizational context.
- **inetOrgPerson**: Extends `organizationalPerson` with internet-related attributes like `mail`.
- **posixAccount**: Defines attributes for a UNIX/Linux user account, such as `uidNumber`, `gidNumber`, and `homeDirectory`.
- **posixGroup**: Defines attributes for a UNIX/Linux group, such as `gidNumber`.
- **organizationalUnit**: A container used to organize other entries.

### **Combining Object Classes for Users**
To create a fully functional user that can log into a Linux system, you must combine multiple object classes. A typical combination is:
```ldif
objectClass: inetOrgPerson
objectClass: posixAccount
```
This combination provides both standard identity attributes (`cn`, `sn`, `mail`) and the necessary POSIX attributes (`uidNumber`, `gidNumber`, etc.) for system authentication.

---

## **LDIF File Structure**

### **Basic LDIF Format**
An LDIF file consists of one or more entries separated by blank lines. Each entry follows this structure:
```ldif
dn: <distinguished name>
objectClass: <object class>
<attribute>: <value>
<attribute>: <value>
```

### **Example User Entry and Breakdown**
```ldif
# The unique address for this user entry
dn: uid=it1,ou=it,dc=armour,dc=local

# --- Object Classes defining the entry type ---
objectClass: top
objectClass: inetOrgPerson
objectClass: posixAccount

# --- Identity Attributes (from inetOrgPerson) ---
cn: IT One
sn: One
uid: it1
mail: it1@armour.local

# --- POSIX Attributes (from posixAccount) ---
uidNumber: 3003
gidNumber: 2004
homeDirectory: /home/it1
loginShell: /bin/bash

# --- Security Attribute ---
userPassword: {SSHA}encrypted_password_here
```

### **Important Rules for LDIF**
- The `dn` must always be the first line of an entry.
- Comments start with a `#` character.
- Blank lines are critical as they separate entries.
- Long lines can be folded (continued) by starting the next line with a single space.

---

## **Creating an Organizational Structure**

### **Order Matters**
When building an LDAP directory from scratch, you must create parent containers before you can add child entries to them. The correct order is:
1.  Domain root (e.g., `dc=armour,dc=local`)
2.  Organizational Units (e.g., `ou=it`, `ou=groups`)
3.  Groups (e.g., `cn=it`)
4.  Users (e.g., `uid=it1`)
5.  Group memberships (modifying groups to add users)

### **Organizational Units vs. Groups**
- **Organizational Unit (OU):** A folder or container used for organizing entries. Its purpose is to structure the directory.
- **Group:** A logical collection of users, primarily used to grant permissions or define access control.

---

## **A Complete, Step-by-Step LDIF Example**

This example shows the separate LDIF files needed to build the `armour.local` directory in the correct order.

### **1. Base Domain**
File: `01-base-domain.ldif`
```ldif
dn: dc=armour,dc=local
objectClass: top
objectClass: dcObject
objectClass: organization
o: Armour Infosec
dc: armour
```

### **2. Organizational Units**
File: `02-organizational-units.ldif`
```ldif
dn: ou=it,dc=armour,dc=local
objectClass: organizationalUnit
ou: it

dn: ou=hr,dc=armour,dc=local
objectClass: organizationalUnit
ou: hr

dn: ou=groups,dc=armour,dc=local
objectClass: organizationalUnit
ou: groups
```

### **3. Groups**
File: `03-groups.ldif`
```ldif
dn: cn=it,ou=groups,dc=armour,dc=local
objectClass: posixGroup
cn: it
gidNumber: 2004

dn: cn=hr,ou=groups,dc=armour,dc=local
objectClass: posixGroup
cn: hr
gidNumber: 2005
```

### **4. Users**
File: `04-users.ldif`
```ldif
dn: uid=it1,ou=it,dc=armour,dc=local
objectClass: inetOrgPerson
objectClass: posixAccount
cn: IT One
sn: One
uid: it1
uidNumber: 3003
gidNumber: 2004
homeDirectory: /home/it1
loginShell: /bin/bash
userPassword: {SSHA}encrypted_password_for_it1

dn: uid=hr1,ou=hr,dc=armour,dc=local
objectClass: inetOrgPerson
objectClass: posixAccount
cn: HR One
sn: One
uid: hr1
uidNumber: 3001
gidNumber: 2005
homeDirectory: /home/hr1
loginShell: /bin/bash
userPassword: {SSHA}encrypted_password_for_hr1
```

### **5. Group Memberships**
File: `05-group-memberships.ldif`
```ldif
dn: cn=it,ou=groups,dc=armour,dc=local
changetype: modify
add: memberUid
memberUid: it1

dn: cn=hr,ou=groups,dc=armour,dc=local
changetype: modify
add: memberUid
memberUid: hr1
```

---

## **Working with LDIF Files**

### **Applying LDIF Files**

To add new entries from an LDIF file.

```bash
ldapadd -x -D "cn=admin,dc=armour,dc=local" -W -f 01-base-domain.ldif
```
*   `-x`: Use simple authentication.
*   `-D`: Specify the Distinguished Name to bind (log in) as.
*   `-W`: Prompt for the password.
*   `-f`: Specify the input file.

To modify existing entries, such as adding members to a group.

```bash
ldapmodify -x -D "cn=admin,dc=armour,dc=local" -W -f 05-group-memberships.ldif
```
---
