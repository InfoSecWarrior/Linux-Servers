# **Configure Centralized Home Directories with NFS**

This guide details how to configure the server to share home directories via NFS and how to configure clients to automatically mount them using AutoFS.

---

## **Server-Side Configuration (`centos.armour.local`)**

### **Install NFS Packages**

Install the necessary packages for the NFS server.

```bash
dnf install nfs-utils -y
```

### **Configure NFS Exports**

Edit the NFS exports file to define which directories to share.

```bash
vim /etc/exports
```

Add the following line to share the `/home` directory with all clients on the network.

```
/home   *(rw,sync,no_root_squash,no_subtree_check)
```

### **Enable and Start NFS Services**

Enable the core NFS services to start on boot and start them now.

```bash
systemctl enable rpcbind --now
```

```bash
systemctl enable nfs-server --now
```

Apply the new export configuration without needing a full restart.

```bash
exportfs -arv
```

### **Configure the Firewall**

Add the required NFS services to the firewall rules permanently.

```bash
firewall-cmd --add-service=nfs --permanent
```

```bash
firewall-cmd --add-service=rpc-bind --permanent
```

```bash
firewall-cmd --add-service=mountd --permanent
```

Reload the firewall to apply the new rules.

```bash
firewall-cmd --reload
```

---

## **Client-Side Configuration (`c1.armour.local`)**

### **Install Client Packages**

Install the NFS client utilities and the AutoFS service.

```bash
dnf install nfs-utils autofs -y
```

### **Remove Local Home Directories**

Before configuring AutoFS, remove any local home directories that may have been created during previous login tests.

```bash
rm -rf /home/it1 /home/hr1 /home/it2 /home/hr2
```

### **Configure AutoFS**

Edit the AutoFS master map file.

```bash
vim /etc/auto.master
```

Add the following line to tell AutoFS how to handle the `/home` directory.

```
/home   /etc/auto.home  --timeout=60
```

Next, create the specific map file for the home directories.

```bash
vim /etc/auto.home
```

Add the following line. The `*` is a wildcard that matches any user, and the `&` is a variable that substitutes the username.

```
* -rw,soft,intr centos.armour.local:/home/&
```

### **Enable and Start AutoFS Service**

Enable the AutoFS service to start on boot and start it now.

```bash
systemctl enable autofs --now
```

---

## **Testing the Centralized Home Directory**

### **Test on the Client**

Log in as an LDAP user on the client machine. AutoFS will automatically mount the home directory on demand.

```bash
su - it1
```

Once logged in, verify the current directory is the user's home.

```bash
pwd
```

Create a test file to verify write permissions.

```bash
touch test-file-from-client.txt
```

Log out of the user's session.

```bash
exit
```

### **Verify on the Server**

On the server, check if the file created by the client exists in the shared `/home/it1` directory.

```bash
ls -l /home/it1/test-file-from-client.txt
```
---
